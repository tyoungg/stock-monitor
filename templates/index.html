<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Alert Rules Editor</title>
    <style>
        body { font-family: sans-serif; }
        .container { margin: 20px; }
        .rules-table, .alerts-table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
        .rules-table th, .rules-table td, .alerts-table th, .alerts-table td { border: 1px solid #ddd; padding: 8px; }
        .rules-table th { background-color: #f2f2f2; }
        .form-buttons { margin-top: 10px; }
        .add-row, .save-rules, .clear-alerts { padding: 10px 15px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        .clear-alerts { background-color: #f44336; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Stock Alert Rules Editor</h1>
        <form action="/save" method="post">
            <table class="rules-table" id="rules-table">
                <thead>
                    <tr>
                        <th>Symbol</th>
                        <th>Low</th>
                        <th>High</th>
                        <th>% Up</th>
                        <th>% Down</th>
                        <th>Webhook</th>
                    </tr>
                </thead>
                <tbody>
                    {% for rule in rules %}
                    <tr>
                        <td><input type="text" name="symbol" value="{{ rule.symbol }}"></td>
                        <td><input type="text" name="low" value="{{ rule.low }}"></td>
                        <td><input type="text" name="high" value="{{ rule.high }}"></td>
                        <td><input type="text" name="pct_up" value="{{ rule.pct_up }}"></td>
                        <td><input type="text" name="pct_down" value="{{ rule.pct_down }}"></td>
                        <td><input type="text" name="webhook" value="{{ rule.webhook }}"></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div class="form-buttons">
                <button type="button" class="add-row" onclick="addRow()">Add Row</button>
                <button type="submit" class="save-rules">Save Rules</button>
            </div>
        </form>

        <h2>Silenced Alerts</h2>
        <table class="alerts-table">
            <thead>
                <tr>
                    <th>Symbol</th>
                    <th>Silenced Alert Types</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for symbol, silenced_types in alert_state.items() %}
                <tr>
                    <td>{{ symbol }}</td>
                    <td>{{ ", ".join(silenced_types) }}</td>
                    <td>
                        {% for alert_type in silenced_types %}
                        <form action="/reenable" method="post" style="display:inline;">
                            <input type="hidden" name="symbol" value="{{ symbol }}">
                            <input type="hidden" name="alert_type" value="{{ alert_type }}">
                            <button type="submit">Re-enable {{ alert_type }}</button>
                        </form>
                        {% endfor %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <form action="/clear_all" method="post">
            <button type="submit" class="clear-alerts">Clear All Silenced Alerts</button>
        </form>
    </div>

    <script>
        function addRow() {
            var table = document.getElementById("rules-table").getElementsByTagName('tbody')[0];
            var newRow = table.insertRow();
            var cell1 = newRow.insertCell(0);
            var cell2 = newRow.insertCell(1);
            var cell3 = newRow.insertCell(2);
            var cell4 = newRow.insertCell(3);
            var cell5 = newRow.insertCell(4);
            var cell6 = newRow.insertCell(5);
            cell1.innerHTML = '<input type="text" name="symbol">';
            cell2.innerHTML = '<input type="text" name="low">';
            cell3.innerHTML = '<input type="text" name="high">';
            cell4.innerHTML = '<input type="text" name="pct_up">';
            cell5.innerHTML = '<input type="text" name="pct_down">';
            cell6.innerHTML = '<input type="text" name="webhook">';
        }
    </script>
</body>
</html>